---
title: "Homework 3: p8105_hw3_ab4797.git"
author: "Ani Bilazarian"
date: "10/11/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
devtools:: install_github("p8105/p8105.datasets")
```

_ Import Instacart Data
```{r message=FALSE, warning=FALSE}
instacart_data = 
  library(p8105.datasets)
data("instacart") 
```

_ Clean & Import Data 

* Change Product Name to a factor variable
* Renaming variables

```{r}
instacart = 
  instacart %>% 
  janitor::clean_names() %>% 
  rename("order_cart" = add_to_cart_order, "day" = order_dow, "hour" = order_hour_of_day, "name" = product_name) %>% 
  mutate(name = as.factor(name))
```

_ Explore Data 

* The instacart dataset comes from an online grocery service with over 3 million online grocery orders from more than 200,000 Instacart users. This dataset allows us to observe trends in online grocery purchasing. The main variables are name (indicating the type of product), aisle (indicating which aisle the product came from) and the hour and day of the week that these items were ordered. Here are a variety of ways we can explore the data. With summmarize, we can observe the different types of products and how many people order. 

```{r}
instacart %>% 
  group_by(name) %>% 
  summarize(n= n())
```

_ Exploratory plot

* I started doing exploratory plots and saw quite quickly that the distribution of products ordered is extremely right skewed. There are by far fewer products that people order time and time again (> 5000) then items that are bought infrequently I wanted to identify which products are ordered by far the most. These are Bananas, Strawberries, Spinach, and other fruits and vegetables. 

```{r}
instacart %>% 
  count(name) %>% 
  filter(n > 5000) %>% 
  mutate(name = fct_reorder(name, n, .desc = TRUE)) %>% 
  ggplot (aes(x = name, y = n)) + coord_flip() + 
	  geom_bar(stat = "identity") + labs(title = "Plot of Items Ordered for each Aisle", x = "Aisle ", y = "number of orders")
```


_ Understanding average day and average hour of purchases

* Here we are looking at the product name and the average day and hour people are ordering products. For example, of 461 orders of 1% Lowfat Milk, the average day to buy was 2.7 and 13th hour. So people are buying milk at the middle of their days! That is approximately the same day and hour that pepole are buying 100 calorie per bag popcorn, interesting! 

```{r}
instacart %>% 
   group_by(name) %>% 
  summarize(n = n(),
            mean_hour = mean(hour, na.rm = TRUE), 
            mean_day = mean(day, na.rm = TRUE)
            ) %>% 
    mutate(product_ranking = min_rank(n))
```


_ Counting Aisles 

* Here we can see that there are 134 aisles. 

```{r}
instacart %>% 
count(aisle_id, aisle)
```

_ Which aisles are the most items ordered from? 

* Here we can see the top 5 aisles that items are ordered from. The aisles with the top purchases are "water seltzer sparkling water" and "yogurt". In fact, there are more purchases from the yogurt aisle then the last three combined! What does this mean for lactose intolerance. 

```{r}
instacart %>% 
  count(aisle) %>%
  filter(min_rank(desc(aisle)) < 6 )
```










